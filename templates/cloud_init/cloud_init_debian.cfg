#cloud-config

growpart:
  mode: auto
  devices: ['/']

hostname: ${hostname}
fqdn: ${fqdn}

ssh_deletekeys: true
ssh_genkeytypes: ['rsa', 'ecdsa', 'ed25519']
ssh_quiet_keygen: true
disable_root: true
ssh_pwauth: false

users:
  - name: root
    lock_passwd: true
%{ for user in users }
  - name: ${user.name}
  %{ if user.password != "" }
    lock_passwd: false
    passwd: ${user.password}
  { else }
    lock_passwd: true
  %{endif }
    ssh-authorized-keys: ${user.ssh_keys}
  %{if user.sudo}
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: [sudo, docker]
  { else }
    groups: [docker]
  %{ endif }
    shell: ${user.shell}
%{ endfor }
package_update: true
packages: ${os_packages}
package_upgrade: true
package_reboot_if_required: true

runcmd:
  - apt-get clean
